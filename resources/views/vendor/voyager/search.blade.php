
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <style>
        .search-three-btn .same-width.three-btn .btn-primary{
          position:relative;
         }
        .tool-tip{
          left:auto;
          top:-12px;
          right:-12px;
        }
        .panel.widget .tool-tip i{
          font-size:12px;
          color#000;
          height:15px;
          width:15px;
          background-color:transparent;
          line-height:14px;
          display: inline-block;
        }
        .nd-none{
          display:none;
         }
        h6{
          font-size:12px;
          color:black;
        }
        #businessConsent label.error {
          position: initial !important;
         }
        .commap-team-popup .modal-header .close {
          right: -15px !important;
          top: -15px !important;
         }

        div#dataTable_filter label.error, label.error, #send_comprehensive_request label.error {
            color: red !important;
             position: relative;
            bottom: 0;
            font-size: 13px;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
               -webkit-appearance: none;
               margin: 0;
        }
        input[type=number] {
         -moz-appearance: textfield;
        }

        @media screen and (min-width:997px) {
         .mybtn
         {
          height: 40px;
          width:110px;
          text-decoration: underline;
          background-color: white;
          border: 2px solid #B7B6B6;
          font-weight: bold;
          border-radius: 5%;
          right: 10px;
          top: 20px;
          position: absolute;
         }
        }

        @media screen and (max-width:600px) {
         .mybtn{
          height: 40px;
            width:120px;
           text-decoration: underline;
            background-color: white;
            border: 2px solid #B7B6B6;
            margin-left: 160px;
            font-weight: bold;
            border-radius: 5%;
         }
        }
        @media(min-width:1259px){
	.recordent_report .comingsoon{
    margin-left: 163px !important;

	}
}
        @media screen and (max-width:500px) {
          .mybtn{
          height: 40px;
            width:140px;
         text-decoration: underline;
            background-color: white;
            border: 2px solid #B7B6B6;
            margin-left: 160px;
            font-weight: bold;
            border-radius: 5%;
         }
        }

        @media screen and (max-width:800px) {
          .mybtn{
            height: 40px;
            width:120px;
            text-decoration: underline;
            background-color: white;
            border: 2px solid #B7B6B6;
            margin-left: 150px;
            font-weight: bold;
            border-radius: 5%;
         }
        }
        @media screen and (max-width:600px) {
          .mybtn{
            margin-left: 76px !important;

         }
        }
         @media screen and (min-width:800px){
             .section1{
               display: none;
             }
             .section3{
              display: none;
             }
         }

         @media (max-width:767px) {

            .csd-full-width{
              width:100%;
              max-width:100%;
            }

            .csd-d-none{
              display:none;
             }

            .csd-d-block{
              display:block;
             }

            .csd-flex-wrap{
            -ms-flex-wrap:wrap;
            flex-wrap:wrap
           }
         }
            .commap-team-popup.video-pop .modal-content {background-color:transparent;padding:0;padding-top: 180px;}
            .commap-team-popup.video-pop .watch-video{width:560px; height:250px;}
            .commap-team-popup.video-pop .watch-video iframe{width:100%; height:100%;}

            .commap-team-popup.video-pop .watch-video .close{position:absolute; padding:0; left:auto; right:-13px; top:-13px; height:30px; width:30px; text-shadow:none; color:#fff; z-index:9; opacity:1;}
            .commap-team-popup.video-pop .watch-video .close::after{height:30px; position:absolute;  width:30px; border-radius:100%; background-color:#273581; top:0; left:0; content:""; z-index:-1;}

            .commap-team-popup.video-pop .modal-dialog{max-width:560px;}
            .commap-team-popup.video-pop  .modal-body{padding:0;}


            .commap-team-popup .modal-content{border:none; border-radius:0; padding:12px;}

            .commap-team-popup .modal-content .team-photo{height:160px; width:160px; margin:0 auto 30px; border-radius:100%; overflow:hidden;}

            .commap-team-popup .modal-content .team-photo img{max-width:100%;}

            .commap-team-popup .modal-header .close{position:absolute; padding:0; left:auto; right:0; top:0; height:30px; width:30px; text-shadow:none; color:#fff; z-index:9; opacity:1;}

            .commap-team-popup .modal-header .close::after{height:30px; position:absolute;  width:30px; border-radius:100%; background-color:#273581; top:0; left:0; content:""; z-index:-1;}

            @media screen and (max-width:500px) {

               .commap-team-popup.video-pop .modal-content {background-color:transparent; padding:0;padding-top: 180px;}
            .commap-team-popup.video-pop .watch-video{width:330px; height:250px;}
            .commap-team-popup.video-pop .watch-video iframe{width:100%; height:100%;}

            .commap-team-popup.video-pop .watch-video .close{position:absolute; padding:0; left:310px; right:15px; top:-8px; height:30px; width:30px; text-shadow:none; color:#fff; z-index:9; opacity:1;}
            .commap-team-popup.video-pop .watch-video .close::after{height:30px; position:absolute;  width:30px; border-radius:100%; background-color:#273581; top:0; left:0; content:""; z-index:-1;}

            .commap-team-popup.video-pop .modal-dialog{max-width:560px;}
            .commap-team-popup.video-pop  .modal-body{padding:0;}


            .commap-team-popup .modal-content{border:none; border-radius:0; padding:12px;}

            .commap-team-popup .modal-content .team-photo{height:160px; width:160px; margin:0 auto 30px; border-radius:100%; overflow:hidden;}

            .commap-team-popup .modal-content .team-photo img{max-width:100%;}

            .commap-team-popup .modal-header .close{position:absolute; padding:0; left:auto; right:0; top:0; height:30px; width:30px; text-shadow:none; color:#fff; z-index:9; opacity:1;}

            .commap-team-popup .modal-header .close::after{height:30px; position:absolute;  width:30px; border-radius:100%; background-color:#273581; top:0; left:0; content:""; z-index:-1;}

        label.error {
            color: red !important;
            bottom: 0;
            top: 64px !important;
            font-size: 13px;
        }
    }
    </style>


    <div class="clearfix container-fluid ">
        <div class="same-wid-box d-flex flex-wrap search-three-btn">
            <div class="panel widget">

              <div class="same-width">
                <h3 class="text-center"> Check Credit &amp; Payment History</h3>
                <hr>
                <div class="alert alert-success hide" role="alert"></div>
                <div class="alert alert-danger hide" role="alert">
                </div>
                <div class="recordent_report">
                    <div class="form-check form-check-inline">

                      <div class="inline">
                          <input class="form-check-input" type="radio" name="report" id="recordentReport" value="Recordent Report">
                          <label class="form-check-label" for="mobe">Recordent Report <span class="tool-tip tool-tip-adv"  data-toggle="tooltip" data-placement="top" title="Recordent report comprises details of any dues reported for a customer by a Recordent member. These dues will provide history of non-banking credit payment behavior for the customer"><i class="fa fa-info-circle"></i></span></label>
                        </div>

                        <div class="inline" id="comprReport">
                          <input class="form-check-input" type="radio" name="report" id="recordentComprehensive" value="Recordent Comprehensive Report">
                          <label class="form-check-label" for="emaile">Recordent Comprehensive Report <span class="tool-tip tool-tip-adv"  data-toggle="tooltip" data-placement="top" title="Recordent comprehensive report not only provides payment behavior for a customer for non-banking credit but also any banking credit reported to the bureau partner. The comprehensive report is powered by Equifax"><i class="fa fa-info-circle"></i></span></label>
    					  <!-- <p class="comingsoon">Coming Soon !</p>  -->

                        </div>
                    </div>
                    <p class="comingsoon">Data powered by Equifax</p>
                    <p class="report-error">Please select a product</p>
                </div>
                <ul class="nav nav-tabs d-flex justify-content-center">

                <li class="active"><a data-toggle="tab"  data-target="#individual" style="cursor: pointer;" >Individual</a></li>
                  <li ><a data-toggle="tab"  data-target="#business" style="cursor: pointer;">Business</a></li>
                </ul>
                <div class="tab-content">
                    <div id="business" class="tab-pane">
                        <form action="{{route('business.all-records')}}" method="get" id="businessConsent">

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row new_width">
                                        <div class="advanced-search">
                                            <div class="d-flex justify-content-center flex-wrap">
                                                <div class="col-md-6">
                                                    <label>{{General::getLabelName('unique_identification_number')}}: </label>
                                                    <input type="text" name="unique_identification_number"class="form-control" id="UDISE_NO" aria-controls="dataTable" value="{{!empty(app('request')->input('unique_identification_number')) ? app('request')->input('unique_identification_number') : '' }}">
                                                     <div id=div2 style="color: red;"></div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Concerned Person Phone:</label>
                                                    <input type="number" name="concerned_person_phone"class="form-control " placeholder="" id="contact_phone_business" aria-controls="dataTable" value="{{!empty(app('request')->input('concerned_person_phone')) ? app('request')->input('concerned_person_phone') : '' }}" required maxlength="10" minlength="10" onkeypress="return numbersonly(this,event)" onblur="trimIt(this);">
                                                </div>

                                            </div>


                                            <p class="consent_button_desc">By clicking search, a consent request will be sent to the customers mobile number</p>
    										@if(Auth::user()->role_id !== 1)
                                            <div class="d-flex justify-content-center flex-wrap">
                                                    <button type="button" class="btn btn-primary requestConsentBusiness"  aria-controls="dataTable"><!-- Request Consent --> Search</button>
                                                    <!-- <button type="reset" class="btn btn-primary"  aria-controls="dataTable">Reset</button> -->
                                            </div>
    										@endif
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                     </div>
                    <div id="individual" class="tab-pane in active">
                        <form action="{{route('all-records')}}" method="get" id="individualConsent">
                            <div class="row">
                            <div class="col-md-12">
                                <div class="row new_width">
                                  <div class="advanced-search">
                                    <div class="d-flex justify-content-center flex-wrap">
                                        <div class="col-md-6">
                                                    <label> Full Name:</label>
                                                    <input type="text" name="student_first_name"class="form-control " placeholder="" aria-controls="dataTable" value="{{!empty(app('request')->input('student_first_name')) ? app('request')->input('student_first_name') : '' }}" id="student_first_name">
                                                </div>
                                        <div class="col-md-6">
                                            <label>Mobile Number:</label>
                                            <input type="number" name="contact_phone"class="form-control " placeholder="" aria-controls="dataTable" value="{{!empty(app('request')->input('contact_phone')) ? app('request')->input('contact_phone') : '' }}" id="contact_phone"  required onblur="trimIt(this);" maxlength="10" onkeypress="return numbersonly(this,event)">
                                        </div>


                                    </div>


                                    <p class="consent_button_desc">By clicking search, a consent request will be sent to the customers mobile number</p>
    								@if(Auth::user()->role_id !== 1)
                                    <div class="d-flex justify-content-center flex-wrap">
                                        <button type="button" class="btn btn-primary requestConsent" aria-controls="dataTable"><!-- Request Consent -->Search</button>
                                        <!-- <button type="reset" class="btn btn-primary"  aria-controls="dataTable">Reset</button> -->
                                    </div>
    								@endif
                                 </div>

                                </div>
                            </div>




                            </div>

                       </form>
                    </div>

                </div>
              </div>
            </div>



            <div class="panel widget d-flex flex-wrap align-items-center" id="section2">

                      <button href="javascript:void" data-toggle="modal" data-target="#exampleModalCenter" class="mybtn"><h5> View Demo</h5></button>

                      <div class="same-width three-btn">

                          <div class="w-100">
                     <h3>Submit Dues</h3>
                <hr>
                  </div>
                  <div class="d-flex flex-wrap justify-content-center">
                        <p><a href="{{route('add-record')}}" class="btn btn-primary">Individual Customer Dues</a><h6 class="nd-none csd-d-block col-md-3">Submit details on payments to be received from individual or B2C customers</h6></p>
                        <p><a href="{{route('business.add-record')}}" class="btn btn-primary">Business Customer Dues</a><h6 class="nd-none csd-d-block col-md-3">Submit details on payments to be received from other businesses or B2B customers</h6></p>
                  </div>

                      <div class="col-lg-6">
                        <h6 class="csd-d-none" style="padding-left:45px;">Submit details on payments to be received from individual or B2C customers</h6>
                      </div>

                      <div class="col-lg-6">
                        <h6 class="csd-d-none" style="padding-right:45px;">Submit details on payments to be received from other businesses or B2B customers</h6>
                      </div>

                   </div>

                      <div class="same-width three-btn">
                          <div class="w-100">
                     <h3> Update Profile</h3>
                <hr>
                  </div>
                  <div class="d-flex flex-wrap justify-content-center">

                        <p><a href="{{route('admin.profile.edit-email')}}" class="btn btn-primary">Update Email</a></p>
                        <p><a href="{{route('voyager.users.edit', Auth::id())}}" class="btn btn-primary">Update GSTIN</a></p>
                  </div>


                      </div>



            </div>
        </div>
    </div>

     <div class="modal fade commap-team-popup video-pop" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
            </div>
            <div class="modal-body">
              <section class="">
                <div class="">
                 <div class="">
                  <div class="">
                   <div class=" watch-video" id="watch-video">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" data-color="red">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <!--<iframe width="560" height="315" src="https://youtube.com/embed/oSDFS7IqiHI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>-->
                      <!--<iframe width="560" height="315" src="/RecordentProductDemo.mp4" frameborder="0" autoplay="false" allow="accelerometer; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>-->
                      <video width="560" height="315" src="/RecordentProductDemo.mp4" controls></video>
                   </div>
                  </div>
                 </div>
                </div>
              </section>
            </div>
          </div>
        </div>
     </div>

    <div class="modal fade commap-team-popup" id="comprehensive_popup" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <p style="text-align: center;font-size: 20px;">Business Credit Report Request</p>
          </div>
          <div class="modal-body">
            <p>Please confirm the below details to continue</p>
            <form action="" name="send_comprehensive_request" id="send_comprehensive_request" method="POST" enctype="multipart/form-data">
              @csrf
              <div class="form-group">
                <label for="contact_phone">Business Name</label>
                <input type="text" class="form-control" name="business_name" id="business_name" maxlength="{{General::maxlength('name')}}" required onblur="trimIt(this);" readonly>
              </div>
              <div class="form-group">
                <label for="contact_phone">Address</label>
                  <textarea class="form-control" id="address" name="address" rows="4" cols="50" onkeypress="return blockSpecialChar(this,event)" onblur="trimIt(this);" readonly>
                  </textarea>
              </div>
              <div class="form-group">
                <label for="contact_phone">State</label>
                  <input type="text" class="form-control" name="state" id="state" readonly>
              </div>
              <div class="form-group">
                <label for="contact_phone">City</label>
                <input type="text" class="form-control" name="city" id="city">
              </div>
              <div class="form-group">
                <label for="contact_phone">Pincode</label>
                  <input type="text" class="form-control" name="pincode" id="pincode" maxlength="6" onblur="trimIt(this);" onkeypress="return numbersonly(this,event)" readonly>
              </div>
              <input type="hidden" class="form-control" name="contact_phone_comprehensive" id="contact_phone_comprehensive" readonly>
              <input type="hidden" class="form-control" name="unique_identification_number" id="unique_identification_number" readonly>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary BusinessComprehensiveReport"  aria-controls="dataTable">Continue</button>
             </div>
           </form>
          </div>
        </div>
      </div>
    </div>
  </head>
</html>



@php
    $cities = General::getCityList();
@endphp
<select id="maincity" style="display: none">
    @if($cities->count())
        @foreach($cities as $city)
            <option data-state-id="{{$city->state_id}}" value="{{$city->id}}">{{$city->name}}</option>
        @endforeach
    @endif
 </select>
 <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
 <script src="{{asset('js/jquery.validate.min.js')}}"></script>
 <script type="text/javascript">
  function trimIt(currentElement){
      $(currentElement).val(currentElement.value.trim());
  }
  function numbersonly(myfield, e,maxlength=null)
   {
        var key;
        var keychar;
        if (window.event)
         key = window.event.keyCode;
        else if (e)
            key = e.which;
        else
            return true;

        keychar = String.fromCharCode(key);
        // control keys
        if ((key==null) || (key==0) || (key==8) || (key==9) || (key==13) || (key==27) )
            return true;
        // numbers
        else if ((("0123456789").indexOf(keychar) > -1)){
          return true;
        }
        else{
          return false;
        }
  }

    $.validator.addMethod("check_gstin", function(value, element) {
      if(value.toString().length == 10) {
        var valueToString = value.toString().toUpperCase();
        // var fourthChar = valueToString.charAt(3);
        // var allowedCharsAtFourthPosition = ["C","H","A","B","G","J","L","F","T"];
        if(valueToString) {
          return this.optional(element) || /^[A-Z]{3}[A|B|C|F|G|H|L|J|P|T]{1}[A-Z]{1}[0-9]{4}[A-Z]{1}$/i.test(value);
        } else {
          return false;
        }
      } else {
          return this.optional(element) || /^[0-3|9]{1}[0-9]{1}[A-Z]{3}[A|B|C|F|G|H|L|J|P|T]{1}[A-Z]{1}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/i.test(value);
      }
    }, "Please enter valid data");

    $.validator.addMethod("mobile_number_india", function(value, element) {
      return this.optional(element) || /^[6789]\d{9}$/i.test(value);
     }, "Please enter a valid number.");

  var individualConsent = $('#individualConsent');
  individualConsent.validate({
      ignore: '',
      rules: {
          contact_phone:{
              maxlength:10,
              mobile_number_india:true
          },
      }
  });

  var businessConsent = $('#businessConsent');
  businessConsent.validate({
      ignore: '',
      rules: {
          concerned_person_phone:{
            required:true,
              maxlength:10,
              mobile_number_india:true
          },
          unique_identification_number: {
              maxlength: 15,
              minlength:2,
              required:true,
              check_gstin:true
            },

      },
      messages: {
            unique_identification_number: {
                maxlength: "Please enter valid data",
                minlength: "Please enter valid data"
            }
          }
  });

  var sendcomprehensiverequest = $('#send_comprehensive_request');
  sendcomprehensiverequest.validate({
      ignore: '',
      rules: {
          city:{
            required:true
          },
      }
  });
</script>
<!-- <script language="javascript" type="text/javascript" src="jquery-1.8.2.js"></script> -->
<script language="javascript" type="text/javascript">
$(function(){
    $('.close').click(function(){
        $("#exampleModalCenter video").attr("src", $("#exampleModalCenter video").attr("src"));
        $('iframe').attr('src', $('iframe').attr('src'));

        //return false;
    });
});


</script>
<script language="javascript" type="application/javascript">
    $(document).ready(function(){
        $(".tab-content #business").find("#state").on('change',function(){

             $(".tab-content #business").find("#city").find('option').remove();
            $(".tab-content #business").find("#city").append('<option value="">ALL</option>');

         if($(".tab-content #business").find("#state").val()!=''){
            var stateId =  $("#state").val();
            $("#maincity option").each(function(){
                if($(this).data('state-id')==stateId){
                    $(".tab-content #business").find("#city").append('<option value="'+$(this).val()+'">'+$(this).text()+'</option>');
                }
            });
          }
        });


  $('.panel-tab').on('click', function(event){
  event.preventDefault();
  $('.panel-stage').slideToggle('slow', function(event){
    if($(this).is(':visible')){
      $('.panel-tab').html('<ic class="voyager-search"></ic>  Advanced Search - close  <span>&#9650;</span>');
    } else {
      $('.panel-tab').html('<ic class="voyager-search"></ic>  Advanced Search - opne  <span>&#9660;</span>');
    }
  });
});


$('.collection_date_info').tooltip('toggle')
        $('.tool-tip').tooltip('toggle');

        $('.collection_date_info').tooltip('hide')
        $('.tool-tip').tooltip('hide');
        $('.collection_date_block').show();
        $("input[name=due_date]").on('dp.change',function(){
             set_collection_date();
        });
        $('.grace_period').on('change',function(){
            set_collection_date();
        });

      $('.report-error').hide();
        $("input[name='report']").click(function(){
          $('.report-error').hide();
            $(document).find('.alert.alert-danger').addClass('hide');
            $(document).find('.alert.alert-success').addClass('hide');
            $(document).find('label.error').addClass('hide');
        });
        $(".requestConsent").on('click',function(){
              var thisButton = $(this);
              if($("input:radio[name='report']").is(":checked")) {
              if($('input:radio[name=report]:checked').val()=="Recordent Report"){
                var report = 1;
              }else{
                var report = 2;
              }
              // var report = $('input:radio[name=report]:checked').val();
              var name=$('#student_first_name').val();
              var contactPhone = $('#contact_phone').val();
              $(document).find('label.error').removeClass('hide');

              if(individualConsent.valid()==true){
                $.ajax({
                 method: 'post',
                 url: "{{route('admin.search_request_consent')}}",
                 data: {
                      name:name,
                      customer_type:'INDIVIDUAL',
                      contact_phone:contactPhone,
                     _token: $('meta[name="csrf-token"]').attr('content')
                 },
                 success:function(data) {
                  setTimeout(function(){
                      document.getElementById("individualConsent").reset();
                    }, 3000);
                    thisButton.attr('disabled','disabled');
                    $(document).find('.alert').addClass('hide');
                    $(document).find('.alert').html('');
                    var dueId = data;
                    $.ajax({
                       method: 'post',
                       url: "{{route('admin.request-consent-store')}}",
                       headers: {
                           'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                       },
                       data: {
                            name:name,
                            customer_type:'INDIVIDUAL',
                            contact_phone:contactPhone,
                            report: report,
                            due_id: dueId,
                           _token: $('meta[name="csrf-token"]').attr('content')
                       }
                    }).then(function (response) {
                        $(document).find('.alert.alert-success').html(response.message);
                        $(document).find('.alert.alert-success').removeClass('hide');
                        $(document).find('.alert.alert-danger').addClass('hide');
                        // window.location.reload();
                        thisButton.removeAttr('disabled');
                        // $(".requestConsent").attr('disabled','disabled');
                        // if(typeof response.lastRequestAccepted!='undefined'){
                        //     $(".checkRequestConsentStatus").removeAttr('disabled');
                        //     return false;
                        // }
                        if($("tr.consentRequestStatusTr").length){
                            clearInterval(xx);
                            $("tr.consentRequestStatusTr").removeClass("hide");
                            $("tr.consentRequestStatusTr").find("td").html('');
                            $("tr.consentRequestStatusTr").find("td").html("<a href='' class='btn btn-primary checkRequestConsentStatus'>Check Status</a> <label>Your consent request is pending.</label>");
                            setTimeout(function(){
                                $("tr.consentRequestStatusTr").find("td").find("label").fadeOut(1000,function(){
                                    $(this).remove();
                                });
                            },5000);

                        }
                        if(response.canRequestConsentAgain24Hour){
                            if(response.startCountDownTimer){
                                //start the timer
                                $(".checkRequestConsentStatus").attr('disabled','disabled');
                                var countDownDate = new Date(response.next3MinForCounDown).getTime();
                                var now = new Date(response.currentTimeInMilli).getTime();
                                // Update the count down every 1 second
                                var x = setInterval(function() {
                                      // Get today's date and time

                                      // Find the distance between now and the count down date
                                      var distance = countDownDate - now;
                                      if(distance < 0){
                                        clearInterval(x);
                                      }
                                      now = now + 1000;
                                      // Time calculations for days, hours, minutes and seconds
                                      if(distance>=0){
                                          var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                          var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                          var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                          var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                          // Display the result in the element with id="demo"
                                          if(seconds<10){
                                            seconds = "0" + seconds;
                                          }
                                          document.getElementById("nextConsentRequestCountDown").innerHTML = 'Request in 0'+minutes + ":" + seconds + " Min";
                                        }

                                          // If the count down is finished, write some text
                                          if (distance < 0) {
                                             $(".checkRequestConsentStatus").removeAttr('disabled');
                                            clearInterval(x);
                                            document.getElementById("nextConsentRequestCountDown").innerHTML='';
                                            $(".requestConsent").removeAttr('disabled');
                                          }
                                    }, 1000);
                            }
                        }else{
                            //$("tr.consentRequestStatusTr").addClass("hide");
                            //You have already raised consent for this user. You can raise consent maximum two times in last 24 hours.
                        }
                    }).fail(function (data) {
                        $(document).find('.alert.alert-danger').html(data.responseJSON.message);
                        $(document).find('.alert.alert-danger').removeClass('hide');
                        $(document).find('.alert.alert-success').addClass('hide');
                        thisButton.removeAttr('disabled');

                    });
                 }
              });
              }
            }else{
              $('.report-error').show();
            }
        });

        $(".requestConsentBusiness").on('click',function(){
          $("#div2").html('').show();
            var thisButton = $(this);
            if($("input:radio[name='report']").is(":checked")) {

                if($('input:radio[name=report]:checked').val()=="Recordent Report"){
                   var report = 1;
                 } else {
                   var report = 3;
                   var unique_identification_number=$('#UDISE_NO').val();
                   var contactPhone = $('#contact_phone_business').val();
                   if(unique_identification_number.length>=15){
                   $.ajax({
                   method: 'post',
                   url: "{{route('admin.get-gstin-api-data',$report='3')}}",
                   headers: {
                       'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                   },
                   data: {
                        unique_identification_number:unique_identification_number,
                       _token: $('meta[name="csrf-token"]').attr('content')
                   },
                   success:function(data){
                    var response= data.response;
                    var address = data.address;
                    var state = data.state;
                    var business_name = data.business_name;
                    var pincode = data.pincode;
                    if(!(response)){
                    // $("#div2").html('').show();

                    $("#div2").html('Please enter valid data').show();
                   //  setTimeout(function() {
                   // $('#div2').fadeOut('slow');
                   // }, 3000);

                    }
                    else {
                    $("#address").val(address);
                    $("#state").val(state);
                    $("#business_name").val(business_name);
                    $("#pincode").val(pincode);
                    $("#contact_phone_comprehensive").val($('#contact_phone_business').val());
                    $("#unique_identification_number").val($('#UDISE_NO').val());
                     // console.log(response);
                     $.ajax({
                       method: 'post',
                       url: "{{route('admin.get-city-api-data')}}",
                       headers: {
                           'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                       },
                       data: {
                            pincode:data.pincode,
                           _token: $('meta[name="csrf-token"]').attr('content')
                       },
                       success:function(data){
                        var city = data.city;
                         if(typeof city !== 'undefined') {
                          $("#city").val(city).attr('readonly','true');
                          $("#comprehensive_popup").modal('show');
                         } else {
                          $("#comprehensive_popup").modal('show');
                         }
                       },
                       error:function(error){
                       $("#comprehensive_popup").modal('show');
                       }
                      });
                     }
                    }
                  });
                }
              }
              // console.log(response);
                // var report = $('input:radio[name=report]:checked').val();
                var unique_identification_number=$('#UDISE_NO').val();
                var contactPhone = $('#contact_phone_business').val();
                if(unique_identification_number.length<=10 || $('input:radio[name=report]:checked').val()=="Recordent Report" ){

                if(businessConsent.valid()==true){
                $.ajax({
                   method: 'post',
                   url: "{{route('admin.search_request_consent_business')}}",
                   data: {
                        unique_identification_number:unique_identification_number,
                        customer_type:'BUSINESS',
                        contact_phone:contactPhone,
                       _token: $('meta[name="csrf-token"]').attr('content')
                   },
                   success:function(data) {
                    setTimeout(function(){
                      document.getElementById("businessConsent").reset();
                    }, 3000);

                $.ajax({
                   method: 'post',
                   url: "{{route('admin.request-consent-store-business')}}",
                   headers: {
                       'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                   },
                   data: {
                        unique_identification_number:unique_identification_number,
                        customer_type:'BUSINESS',
                        contact_phone:contactPhone,
                        report: report,
                        due_id: data,
                       _token: $('meta[name="csrf-token"]').attr('content')
                   }
                }).then(function (response) {
                    $(document).find('.alert.alert-success').html(response.message);
                    $(document).find('.alert.alert-success').removeClass('hide');
                    $(document).find('.alert.alert-danger').addClass('hide');
                    // window.location.reload();
                    thisButton.removeAttr('disabled');
                    // $(".requestConsent").attr('disabled','disabled');
                    // if(typeof response.lastRequestAccepted!='undefined'){
                    //     $(".checkRequestConsentStatus").removeAttr('disabled');
                    //     return false;
                    // }
                    if($("tr.consentRequestStatusTr").length){
                        clearInterval(xx);
                        $("tr.consentRequestStatusTr").removeClass("hide");
                        $("tr.consentRequestStatusTr").find("td").html('');
                        $("tr.consentRequestStatusTr").find("td").html("<a href='' class='btn btn-primary btn-blue checkRequestConsentStatus'>Check Status</a> <label>Your consent request is pending.</label>");
                        setTimeout(function(){
                            $("tr.consentRequestStatusTr").find("td").find("label").fadeOut(1000,function(){
                                $(this).remove();
                            });
                        },5000);

                    }
                    if(response.canRequestConsentAgain24Hour){
                        if(response.startCountDownTimer){
                            $(".checkRequestConsentStatus").attr('disabled','disabled');
                            //start the timer
                            var now = new Date(response.currentTimeInMilli).getTime();
                            var countDownDate = new Date(response.next3MinForCounDown).getTime();
                            // Update the count down every 1 second
                            var x = setInterval(function() {
                                  // Get today's date and time
                                  var now = new Date().getTime();
                                  // Find the distance between now and the count down date
                                  var distance = countDownDate - now;
                                  if(distance < 0){
                                    clearInterval(x);
                                  }
                                  now = now + 1000;
                                  // Time calculations for days, hours, minutes and seconds
                                  if(distance>=0){
                                      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                      var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                      // Display the result in the element with id="demo"
                                      if(seconds<10){
                                        seconds = "0" + seconds;
                                      }
                                      document.getElementById("nextConsentRequestCountDown").innerHTML = 'Request in 0'+minutes + ":" + seconds + " Min";
                                    }

                                      // If the count down is finished, write some text
                                      if (distance < 0) {
                                        $(".checkRequestConsentStatus").removeAttr('disabled');
                                        clearInterval(x);
                                        document.getElementById("nextConsentRequestCountDown").innerHTML='';
                                        $(".requestConsent").removeAttr('disabled');
                                      }
                                }, 1000);
                        }
                    }
                }).fail(function (data) {
                    $(document).find('.alert.alert-danger').html(data.responseJSON.message);
                    $(document).find('.alert.alert-danger').removeClass('hide');
                    $(document).find('.alert.alert-success').addClass('hide');
                    thisButton.removeAttr('disabled');

                });
                   }
                });
           }
         }
      } else{
              $('.report-error').show();
            }

        })
    });
$("#exampleModalCenter").on('hidden.bs.modal', function (e) {
    //$("#exampleModalCenter iframe").attr("src", $("#exampleModalCenter iframe").attr("src"));
    //$("#exampleModalCenter iframe").attr("src", '');
});
 </script>
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
$(document).ready(function(){
  $("a").on('click', function(event) {

    if (this.hash !== "") {
      event.preventDefault();

      var hash = this.hash;

      $('html, body').animate({
        scrollTop: $(hash).offset().top
      }, 800, function(){

        window.location.hash = hash;
      });
    } // End if
  });
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {

    $(document).find('.alert.alert-danger').addClass('hide');
    $(document).find('.alert.alert-success').addClass('hide');
    $(document).find('label.error').addClass('hide');

    var target = $(e.target).attr("href") // activated tab
    // if(target=="#business"){
    //   $(".comingsoon").text('Coming Soon !');
    //   $("#recordentComprehensive").attr("disabled", true);
    //   $("#recordentComprehensive").prop( "checked", false );
    // }else{
    //   $(".comingsoon").text('Data powered by Equifax');
    //   $("#recordentComprehensive").attr("disabled", false);
    // }
  });
});

$(".BusinessComprehensiveReport").on('click',function(){
                var thisButton = $(this);
                var unique_identification_number=$('#UDISE_NO').val();
                var contactPhone = $('#contact_phone_business').val();
                var report = 3;
                var business_name=$('#business_name').val();
                var address=$('#address').val();
                var state=$('#state').val();
                var city=$('#city').val();
                var pincode=$('#pincode').val();
                if(sendcomprehensiverequest.valid()==true){

                $.ajax({
                   method: 'post',
                   url: "{{route('admin.search_request_consent_business')}}",
                   data: {
                        unique_identification_number:unique_identification_number,
                        customer_type:'BUSINESS',
                        contact_phone:contactPhone,
                       _token: $('meta[name="csrf-token"]').attr('content')
                   },
                   success:function(data) {
                    $('#comprehensive_popup').modal('hide');
                    $.ajax({
                    method: 'post',
                    url: "{{route('admin.request-consent-store-business')}}",
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    data: {
                        unique_identification_number:unique_identification_number,
                        customer_type:'BUSINESS',
                        contact_phone:contactPhone,
                        report: report,
                        due_id: data,
                        business_name: business_name,
                        address: address,
                        state: state,
                        city: city,
                        pincode: pincode,
                       _token: $('meta[name="csrf-token"]').attr('content')
                     }
                    }).then(function (response) {
                    $(document).find('.alert.alert-success').html(response.message);
                    $(document).find('.alert.alert-success').removeClass('hide');
                    $(document).find('.alert.alert-danger').addClass('hide');
                    // window.location.reload();
                    thisButton.removeAttr('disabled');
                    // $(".requestConsent").attr('disabled','disabled');
                    // if(typeof response.lastRequestAccepted!='undefined'){
                    //     $(".checkRequestConsentStatus").removeAttr('disabled');
                    //     return false;
                    // }
                    if($("tr.consentRequestStatusTr").length){
                        clearInterval(xx);
                        $("tr.consentRequestStatusTr").removeClass("hide");
                        $("tr.consentRequestStatusTr").find("td").html('');
                        $("tr.consentRequestStatusTr").find("td").html("<a href='' class='btn btn-primary btn-blue checkRequestConsentStatus'>Check Status</a> <label>Your consent request is pending.</label>");
                        setTimeout(function(){
                            $("tr.consentRequestStatusTr").find("td").find("label").fadeOut(1000,function(){
                                $(this).remove();
                            });
                        },5000);

                    }
                    if(response.canRequestConsentAgain24Hour){
                        if(response.startCountDownTimer){
                            $(".checkRequestConsentStatus").attr('disabled','disabled');
                            //start the timer
                            var now = new Date(response.currentTimeInMilli).getTime();
                            var countDownDate = new Date(response.next3MinForCounDown).getTime();
                            // Update the count down every 1 second
                            var x = setInterval(function() {
                                  // Get today's date and time
                                  var now = new Date().getTime();
                                  // Find the distance between now and the count down date
                                  var distance = countDownDate - now;
                                  if(distance < 0){
                                    clearInterval(x);
                                  }
                                  now = now + 1000;
                                  // Time calculations for days, hours, minutes and seconds
                                  if(distance>=0){
                                      var days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                      var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                      var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                      var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                                      // Display the result in the element with id="demo"
                                      if(seconds<10){
                                        seconds = "0" + seconds;
                                      }
                                      document.getElementById("nextConsentRequestCountDown").innerHTML = 'Request in 0'+minutes + ":" + seconds + " Min";
                                    }

                                      // If the count down is finished, write some text
                                      if (distance < 0) {
                                        $(".checkRequestConsentStatus").removeAttr('disabled');
                                        clearInterval(x);
                                        document.getElementById("nextConsentRequestCountDown").innerHTML='';
                                        $(".requestConsent").removeAttr('disabled');
                                      }
                                }, 1000);
                        }
                    }
                }).fail(function (data) {
                    $(document).find('.alert.alert-danger').html(data.responseJSON.message);
                    $(document).find('.alert.alert-danger').removeClass('hide');
                    $(document).find('.alert.alert-success').addClass('hide');
                    thisButton.removeAttr('disabled');
                });
                setTimeout(function(){
                      document.getElementById("businessConsent").reset();
                    }, 2000);

              }
              });
             }
            });

       function blockSpecialChar(myfield, e)
        {

            var key;
            var keychar;
            if (window.event)
                key = window.event.keyCode;
            else if (e)
                key = e.which;
            else
                return true;

            keychar = String.fromCharCode(key);
            console.log(key);
            // control keys
            if ((key==null) || (key==0) || (key==8) || (key==9) || (key==13) || (key==27) ){
                return true;
            }
            // numbers
            else if ( (key==192) || (key==49) || (key==50) || (key==51) || (key==52) || (key==54) || (key==55) || (key==56) || (key==189) || (key==187) || (key==220) || (key==191) || (key==219) || key==221){
                //return false;
            }else if ((("~!@#$^&*_+|\/<>{}[]").indexOf(keychar) > -1)){
                return false;
            }else{
                return true;
            }
        }

  function trimIt(currentElement){
      $(currentElement).val(currentElement.value.trim());
  }

  function numbersonly(myfield, e)
    {
        var key;
        var keychar;
        if (window.event)
            key = window.event.keyCode;
        else if (e)
            key = e.which;
        else
            return true;
        keychar = String.fromCharCode(key);
        // control keys
        if ((key==null) || (key==0) || (key==8) || (key==9) || (key==13) || (key==27) )
            return true;
        // numbers
        else if ((("0123456789").indexOf(keychar) > -1)){
          return true;
        }
        else{
          return false;
        }
    }
    $("#clickhamber").on("click",function(e){

      if ($('.app-container').hasClass('expanded'))
        {
          $("#comprReport").addClass("inline");
        }
        else{
          if(window.screen.width * window.devicePixelRatio == 1366)
         {
           $("#comprReport").removeClass("inline");
         }
        }
});
</script>
